Dugaesescu Andrei 331CC

Tema 1 ASC - Marketplace

	
	Structural implementarea se concentreaza asupra modalitatii de organizare a marketplace-ului doaerece acesta reprezinta intermediarul prin care producatorii si consumatorii comunica si se influenteaza unul pe celalalt. Marketplace-ul are cateva componente importante prin intermediul carora se asigura corectitudinea in executie si sincronizare a thread-urilor. Produsele din marketplace (cele pe care producatorii le produc si cele pe care consumatorii le consuma) se gasesc intr-o lista de dictionare. La pozitia i din lista se gasescte dictionarul asociat producatorului i astfel, in lista se afla atatea dictionare cati producatori exista. Un dictionar este compus din intrari de forma produs: cantitate, unde cheile vor fi reprezentate de produsele publicate de producatori, iar valorile aferente cheilor reprezinta cantitatea disponibila consumatorilor de a consuma.
	La publicarea unui nou produs pentru un producator, acestuia ii va fi creata o noua intrare in dictionarul respectivului producator. Orice alte noi publicari/consumuri ale respectivului produs vor afecta doar valoarea de la cheia respectiva. Pe langa dictionarul de produse, fiecarui producator ii este retinut intr-un alt dictionar, numarul de produse care au fost publicate (producer_queue). In acest dictionar intrarile sunt de tipul id_producator: (numar de produse publicate). La apelul functiei de publicare a unui produs in marketplace valoarea asociata cheii date de id_producator, este interogata iar daca aceasta nu depaseste numarul maxim de produse ce pot fi publicate (queue_size_per_producer) atunci producatorul va putea publica produsul iar valoarea mai sus mentionata va fi incrementata, alternativ, producatorul va fi semnalat referitor la numarul de produse deja existente in marketplace urmand ca acesta sa astepte un timp (republish_wait_time) pana cand va incerca sa publice din nou.
	In ceea ce priveste consumatorii, acestia au fiecare cate un cart in interiorul marketplace-ului, cartul unui consumator fiind identificat dupa id-ul repsectivului consumator (cum un consumator este identificat dupa cart, acest id poata denumirea de cart_id in cadrul porgramului). Pentru retinerea cart-urilor consumatorilor este folosit un dictionar de liste unde cheia este data de id-ul consumatorului, iar valoarea reprezinta o lista de tupluri, fiecare tuplu fiind format dintr-un produs pe care consumatorul l-a adaugat in cart si id-ul producatorului de la care l-a luat. Odata ce un consumator apeleaza place_order(), lista corespunzatoare respectivului consumator este procesata pentru a returna doar produsele din acea lista, nu si id-urile producatorilor dupa care cart-ul este golit pentru a putea fi refolosit.
	Pentru sincronizarea comunicatiei sunt folosite o serie de lock-uri, unul pentru intregistrarea producatorilor, unul pentru inregistrarea consumatorilor si cate un lock pentru fiecare dictionar detinut de catre un producator. Lock-urile pentru inregistrare asigura secventialitatea distribuirii id-urilor atat pentru producatori cat si pentru consumatori iar lock-urile pentru dictionarele producatorilor asigura faptul ca un consumator si un producator nu vor actualiza eronat cantitatea existenta a unui anumit produs.
